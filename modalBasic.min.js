!function($,W){var $wrap,$header,$body,$footer,$close,lastFocus,doCallback,addMarkup,reset,buildConfirm,bind,_mb={args:{callbacks:{beforeInit:void 0,onInit:void 0,beforeMarkup:void 0,onMarkup:void 0,beforeBind:void 0,onBind:void 0,beforeShow:void 0,onShow:void 0,beforeHide:void 0,onHide:void 0,yarp:void 0,narp:void 0}},state:{lang:void 0!==$("html").attr("lang")?$("html").attr("lang"):"en",inited:!1,markedup:!1,bound:!1,visible:!1}},hideClass="_mb_hide_me",showClass="_mb_show_me";_mb.markup='<div id="_mb_uber"><div id="_mb_rel_wrap"><div id="_mb_content_wrap"><div id="_mb_header" class="'+hideClass+'"></div><div id="_mb_body"></div><div id="_mb_footer" class="'+hideClass+'"></div><button id="_mb_close" type="button" title="click to close" aria-label="close modal">x</button></div></div></div>',_mb.confirmMarkup='<div id="_mb_confirm_wrap"><button id="_mb_confirm_narp" data-which="narp" type="button" aria-label="cancel">[narpText]</button><button id="_mb_confirm_yarp" data-which="yarp" type="button" aria-label="confirm">[yarpText]</button></div>',_mb.init=function(args){var args=void 0===args?{}:args;if(_mb.args.addCSS=void 0!==args.addCSS?args.addCSS:!0,_mb.args.addMarkup=void 0!==args.addMarkup?args.addMarkup:!0,void 0!==args.callbacks)for(var c in _mb.args.callbacks)_mb.args.callbacks[c]=void 0!==args.callbacks[c]?args.callbacks[c]:void 0;_mb.state.lang=void 0!==args.lang?args.lang:_mb.state.lang,doCallback("beforeInit"),addMarkup(),bind(),_mb.state.inited=!0,doCallback("onInit")},_mb.show=function(args){if(_mb.state.inited){lastFocus=document.activeElement,lastFocus.blur();var addClass="",showFor=!1,confirm=!1;if(void 0!==args){if(reset(),void 0!==args.header&&$header.html(args.header).removeClass(hideClass),void 0!==args.body&&$body.html(args.body),void 0!==args.footer&&$footer.html(args.footer).removeClass(hideClass),void 0!==args.callbacks)for(var c in args.callbacks)_mb.args.callbacks[c]=args.callbacks[c];void 0!==args.confirm&&buildConfirm(args.confirm),addClass=void 0!==args.addClass?args.addClass:"",showFor=void 0!==args.showFor?args.showFor:!1}doCallback("beforeShow"),$wrap.removeClass().addClass(showClass+" "+addClass),$body.focus(),$footer.find("button").length>-1&&$footer.find("button:enabled:first").focus(),$body.find("form").length>-1&&$body.find('form:not([type="hidden"]) :input:visible:enabled:first').focus(),_mb.state.visible=!0,doCallback("onShow"),showFor&&!confirm&&setTimeout(function(){_mb.hide()},showFor)}},_mb.hide=function(){_mb.state.inited&&(doCallback("beforeHide"),doCallback("narp"),$wrap.removeClass(showClass),_mb.state.visible=!1,lastFocus.focus(),doCallback("onHide"))},_mb.translate=function(ting,lang){if(void 0===ting||""==ting)return!1;lang=void 0!==lang?lang:_mb.state.lang;var original=ting,translation=!1;return"object"!=typeof ting&&(ting=JSON.stringify(ting),ting=JSON.parse(ting)),translation=void 0===ting[lang]?!1:ting[lang],translation||"en"==_mb.state.lang||(translation=void 0===ting.en?!1:ting.en),translation||"string"!=typeof original||(translation=original),translation},doCallback=function(callback){callback=_mb.args.callbacks[callback],"function"==typeof callback&&(_mb.state.bound?callback(_mb,$wrap,$header,$body,$footer,$close):callback(_mb))},addMarkup=function(){return!_mb.args.addMarkup||_mb.state.markedup?!1:(doCallback("beforeMarkup"),$(document.body).append(_mb.markup),_mb.state.markedup=!0,void doCallback("onMarkup"))},reset=function(){$body.empty(),$header.addClass(hideClass).empty(),$footer.addClass(hideClass).empty(),_mb.args.callbacks.narp=void 0,_mb.args.callbacks.yarp=void 0},buildConfirm=function(confirm){var defaults={yarp:{en:"confirm"},narp:{en:"cancel"}},yarpText=void 0!==_mb.translate(confirm.yarp.text)?confirm.yarp.text:defaults.yarp,narpText=void 0!==_mb.translate(confirm.narp.text)?confirm.narp.text:defaults.narp;yarpText=_mb.translate(yarpText),narpText=_mb.translate(narpText),$footer.append(_mb.confirmMarkup.replace("[yarpText]","<span>✓</span> "+yarpText).replace("[narpText]","<span>✗</span> "+narpText)),void 0!==confirm.yarp&&confirm.yarp.disabled&&$("#_mb_confirm_yarp").attr("disabled",!0),void 0!==confirm.narp&&confirm.narp.disabled&&$("#_mb_confirm_narp").attr("disabled",!0),$footer.removeClass(hideClass)},bind=function(){$wrap=$("#_mb_uber"),$header=$("#_mb_header"),$body=$("#_mb_body"),$footer=$("#_mb_footer"),$close=$("#_mb_close"),doCallback("beforeBind"),$(document.body).on("mouseup","#_mb_uber",function(e){e.preventDefault(),e.stopPropagation(),_mb.hide()}).on("click","#_mb_content_wrap",function(e){e.stopPropagation()}).on("click","#_mb_close",function(e){e.preventDefault(),_mb.hide()}).on("click","#_mb_confirm_wrap button",function(e){e.preventDefault();var which=$(this).data("which");doCallback(which),_mb.args.callbacks.narp=void 0,_mb.hide()}),$(W).on("keyup",function(e){27==e.which&&_mb.state.visible&&_mb.hide()}),_mb.state.bound=!0,doCallback("onBind")},W._mb=_mb}($||jQuery,window),"function"==typeof define&&define("_mb",[],function(){return _mb});